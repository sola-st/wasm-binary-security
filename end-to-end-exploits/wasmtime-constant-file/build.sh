#!/bin/bash

# NOTE for the exploit to work, the constant data has to be put _above_ the stack
# linker option: -Wl,-stack-first
wasi/wasi-sdk-8.0-linux/wasi-sdk-8.0/bin/clang --sysroot wasi/wasi-sysroot-8.0/wasi-sysroot -O2 -Wl,--stack-first vuln.c -o vuln.wasm


for wasm in *.wasm
do
    echo "$wasm"
    wasm2wat --generate-names "$wasm" > "$wasm.wat"
    wasm-objdump -xh "$wasm" > "$wasm.objdump"
done
